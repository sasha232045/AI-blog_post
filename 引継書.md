 MkDocs自動ハイパーリンク・ポップアップ機能設定に関する引き継ぎ

  日付: 2025年7月14日月曜日
  担当: Gemini CLI エージェント

  1. 概要

  ユーザーより、MkDocsプロジェクトにおいて、単語に[]を付けずに自動でハイパーリンクを付与する機能（mkdocs-autolink-plugin）と、用語のポップアップ定義機能（mkdocs-glossaryまたはfootnote
  sとpymdownx.snippets）の実装要望がありました。特に、ファイル名とハイパーリンク対象の単語の不一致、および既存設定での機能不全が報告されていました。

  2. 問題点

   * 自動ハイパーリンク: autolinks.ymlのパス設定とMkDocsのURL生成規則の不一致。
   * ポップアップ定義: mkdocs-glossaryまたはfootnotesとpymdownx.snippetsの連携問題。
   * 文字コード: Windows環境における日本語ファイル名やコンテンツの文字化け。

  3. これまでの試行と結果

   1. 試行1: `autolinks.yml` と `mkdocs.yml` のパス形式統一 (ディレクトリURL形式へ)
       * 目的: autolinks.yml のパスをMkDocsのディレクトリURL形式（末尾/）に合わせる。
       * 結果: autolinks.yml と mkdocs.yml の nav パスを / 終わりに修正。しかし、ビルド時に多数の文字化け警告が発生し、根本的な問題が解決されていないことが判明。

   2. 試行2: `use_directory_urls: false` の導入と `autolinks_file` 削除
       * 目的: Windows環境での文字コード問題を回避するため、URL形式を.html終わりに変更し、autolinksプラグインの不要な設定を削除。
       * 結果: autolinks_file の警告は解消されたものの、文字化け警告は継続。nav のパスを .md 終わりに再修正する必要が生じ、設定の複雑化を招いた。

   3. 試行3: ビルド時の文字コード設定 (`python -X utf8 -m mkdocs build`)
       * 目的: Pythonの実行環境で明示的にUTF-8エンコーディングを指定し、文字化け問題を解決する。
       * 結果: 文字化けに関する警告は解消された。しかし、_definitions.md
         および記事ファイル内のフットノート（#fnref:）に関する警告が新たに発生し、ポップアップ定義が機能していないことが判明。

   4. 試行4: `mkdocs-glossary` プラグインの導入
       * 目的: フットノートの複雑な設定を避け、用語集プラグインでシンプルにポップアップ定義を実現する。
       * 結果: AttributeError: '_io.TextIOWrapper' object has no attribute 'abs_src_path'
         というエラーでビルドが失敗。プラグインのバージョンや環境との互換性問題の可能性があり、このアプローチは断念。

   5. 試行5 (現状): `footnotes` と `pymdownx.snippets` に再挑戦
       * 目的: mkdocs-glossary の問題を受け、元のfootnotesとpymdownx.snippetsの組み合わせに戻し、設定を再確認してポップアップ定義の機能化を目指す。
       * 実施内容:
           * mkdocs.yml から glossary プラグインを削除し、pymdownx.snippets と footnotes を再有効化。
           * pymdownx.snippets に base_path: docs を設定。
           * _definitions.md を再作成し、記事ファイル内の参照パスを _definitions.md に修正。
           * 04_用語解説/glossary.md を削除。
       * 結果: ビルドは成功したが、フットノートに関する警告（#fnref:）は依然として残っている。自動ハイパーリンク（mkdocs-autolink-plugin）は機能している可能性が高いが、ポップアップ定義
         はまだ完全に機能していない。

  4. 残された課題

   * ポップアップ定義の完全な機能化: footnotes と pymdownx.snippets を使用した用語のポップアップ表示が、警告なく正しく機能するようにする。特に、_definitions.md
     内のフットノート定義と、記事内での参照が適切に連携しているか、詳細な検証が必要。

  5. 推奨される次のステップ

   * pymdownx.snippets と footnotes の公式ドキュメントを再度詳細に確認し、特にスニペットの読み込みとフットノートの参照に関する設定オプションや注意点を洗い出す。
   * _definitions.md の内容と、記事ファイル（例: 01_AI基礎/01_AIの定義.md）内での [^用語名] の記述が、MkDocsのフットノートの仕様に完全に準拠しているか、厳密に検証する。
   * 必要であれば、mkdocs-material のGitHubリポジトリや関連コミュニティで、同様のフットノートに関する問題が報告されていないか調査し、解決策やワークアラウンドを探る。